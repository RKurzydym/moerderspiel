<div xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      lang="en">
    	<?python
		<div lang="en">
			<style>
				#bgcontainer {
					max-width: 100%;
				}
				p.remtest {
					display: none; /* for testing card width and grid: comment this */
				}
				{# Medienabfragen und dynamische Styles ggf. in externes CSS auslagern #}
			</style>
			<div id="inner-content">
				<p class="remtest">ex</p>
				<div id="listplayers">
					<ul class="cardlist">
						{# Hier Jinja2-Schleifen und Bedingungen für games, subgames, getKilled etc. einfügen #}
						{# Beispiel: #}
						{% for game in games %}
							{% if game.status != 'OPEN' %}
								{% if game.games is defined %}
									{% for subgame in game.games.values() %}
										<li class="card gameinfo">
											{# Subgame-Infos hier einfügen #}
										</li>
									{% endfor %}
								{% endif %}
								<li class="card gameinfo">
									<table>
										{# Spielinfos hier einfügen #}
									</table>
								</li>
							{% endif %}
						{% endfor %}
						{# Killed-List, Regeln, weitere Blöcke analog umsetzen #}
					</ul>
				</div>
			</div>
		</div>
				<li class="card rules" py:if="game.status == 'RUNNING' and len(game.getKilled()) &lt; 5">
					<h3>Aufträge abholen</h3>
					<p>Irgendwo gibts eine Auftragsauslage. Nimm dir dort den Auftragszettel, der mit deinem
					Namen beschriftet ist. Außerdem eine Markierung.
					</p><p>Vielleicht liegen später erneut welche dort für dich. Guck da hin und wieder mal vorbei.
					</p>
				</li>
				<li class="card rules" py:if="game.status != 'OVER'">
					<h3>Morden</h3>
					<p>&#10122;&nbsp;Finde dein(e) Opfer. &#10123;&nbsp;Gib dem Opfer ohne anwesende Zeugen einen beliebigen Gegenstand, den es
					auch freiwillig annehmen muss. &#10124;&nbsp;Sag "Du bist tot". &#10125;&nbsp;Erhalte vom Opfer den Auftrag 
					aus dem Kreis, in dem es grad ermordet wurde. &#10126;&nbsp; Trage den Mord ein. &#10127;&nbsp;??? &#10128;&nbsp;Profit!</p>
				</li>
				<py:for each="game in games">
					<li class="card rules" py:if="game.status == 'RUNNING'">
						<h3>Mord melden!</h3>
						<img style="float:right; height:90%; image-rendering: crisp-edges;" src="data:image/png;base64,${utils.qrdata(game.url, version=1)}"></img>
						<p>Du brauchst dazu den Signaturcode von deinem erledigten Auftrag. Dann kannst du den Mord hier melden:</p>
						<p><a href="${game.url}">${game.url.replace('http://', '')}</a>
						</p>
					</li>
				</py:for>
				<li class="card rules" py:if="game.status != 'OVER'">
					<h3>Keine lebenden Zeugen!</h3>
					<p>Morde haben ohne lebende Zeugen zu geschehen (Spielleiter/Nichtspieler sind tot). Das Opfer kann nach einem Mord fragen,
					ob jemand die Übergabe gesehen hat. Ist dies der Fall, gilt der Mord als schiefgelaufen,
					das Opfer behält seinen Auftrag.</p>
				</li>
				<li class="card rules" py:if="game.status == 'RUNNING' and len(game.getKilled()) &lt; 24">
					<h3>Markierung</h3>
					<p>Anhand der ausgegebenen Markierung erkennt man andere Mitspieler. Wer morden will, muss seine 
					Markierung erkennbar am Körper/Namensschild tragen.
					</p><p>Wer seine Markierung nicht offen trägt, kann nicht morden, aber ermordet werden!</p>
				</li>
				<li class="card rules" py:if="game.status == 'RUNNING'">
					<h3>Neue Aufträge</h3>
					<p>Manchmal hat der Spielleiter einen neuen Auftrag für dich. Dann wird dieser an der 
					Auftragsausgabe zur Abholung ausgelegt. Also guck hin und wieder mal dort.
					</p>
				</li>
				<li class="card rules" py:if="game.status == 'RUNNING'">
					<h3>Mordfreie Zonen</h3>
					<p>Alle Orte der persönlichen Hygiene und Schlafräume sind mordfreie Zonen.
					Weitere können vereinbart werden, müssen dann aber deutlich gekennzeichnet sein,
					andernfalls gelten sie nicht für hinzukommende Spieler.</p>
				</li>
				<li class="card rules" py:if="game.status == 'RUNNING' and len(game.getKilled()) &lt; 18" >
					<h3>Verlust des Auftragszettels</h3>
					<p>Guck in deine Mails. Da stehen immer alle aktuellen Aufträge als PDF zum ausdrucken.</p>
					<h3>Papier hat Vorrang</h3>
					<p>Erst wenn jede/r Daueronline ist, können wir auf ausgedruckte Aufträge verzichten.</p>
				</li>
				<li class="card rules" py:if="game.status == 'RUNNING'">
					<h3>Vorzeitiges Aussteigen</h3>
					<p>Sag dem Spielleiter Bescheid. Dieser schmeißt dich aus dem Spiel und benachrichtigt
					die Leute, die dadurch neue Aufträge kriegen.</p>
					<h3>Auftragszettel gefunden?</h3>
					<p>Bitte beim Spielleiter abgeben!
					</p>
				</li>
			</py:if>
		</ul>
	    	<py:for each="game in games" py:if="False and len(games) == 1">
		<py:if test="game.status == 'OPEN'">
			<h3>Liste der Mitspieler</h3>
			<table>
				<tr>
					<th>Name</th>
					<th>Gruppe</th>
				</tr>
				<py:for each="player in game.players">
					<tr><td>${player.name}</td><td>${player.info}</td></tr>
				</py:for>
			</table>
		</py:if>
		</py:for>
    	<py:for each="game in games">
		<div py:if="game.status == 'OPEN'" class="teaser listplayers">
			<h1>Das Mörderspiel lädt zur Teilnahme ein!</h1>
			<a name="game-${game.name}"></a>
			<ul class="cardlist">
				<li class="card gameinfo">
					<table>
						<tr><td>Spiel</td><td>${game.name}</td></tr>
						<tr py:if="game.desc"><td colspan="2"><strong>${game.desc}</strong></td></tr>
						<tr><td>Spieler</td><td>${len(game.players)}</td></tr>
					</table>
				<h2>Mitspielen?<br/><a href="${game.url}">${game.url.replace('http://', '')}</a><br/>...oder QR-Code scannen:</h2>
				</li>
				<li class="card">
					<img src="data:image/png;base64,${utils.qrdata(game.url, version=3)}"></img>
				</li>
			</ul>
		</div>
	</py:for>
	</div>
</div>
<script type="text/javascript">
// <![CDATA[
jQuery.easing['jswing'] = jQuery.easing['swing'];

jQuery.extend( jQuery.easing,
{	
	def: 'easeOutQuad',
	easeInQuart: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t + b;
	},
	easeOutQuart: function(x, t, b, c, d) {
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	}
});

var timer;
var running = false;
var animationduration = 70;
var mousemovetimeout;

function runAnimation(duration) {
	var anchors = $('a[name]')
	if( anchors.length > 0 ) {
		var timeslot = ((duration-8)*1000.0)/((anchors.length*2))
		anchors.each(function(i, element) {
			$('html, body').delay(timeslot).animate({
				scrollTop: element.offsetTop
			}, timeslot);
		});
	} else {
		$("html, body").animate({ scrollTop: $(document).height()-$(window).height() }, (duration-8)*1000, "easeInQuart");
	}
}

function startAnimation() {
	var enable = "<p><b>Autoreload und Autoscrollen aktiv.</b></p><p>Zyklus: "+animationduration+" Sekunden.</p><p>Zum deaktivieren irgendwo hinklicken.</p><p>Größeneinstellung: Strg-plus und Strg-minus.</p><p>Geschwindigkeit: + und -</p>";
	messageoverlay(enable, "1.5");
	$('body').css('cursor', 'none');
	runAnimation(animationduration);
	timer = setInterval(function() {
		$("html, body").animate({ scrollTop: 0 }, "1000", "swing");
		ajax('wall', {'id':'${":".join([g.id for g in games])}'}); 
		runAnimation(animationduration);
	}, animationduration*1000);
}
function stopAnimation() {
	var disable = "<p><b>Autoreload und Autoscrollen inaktiv.</b></p><p>Zum Aktivieren irgendwo hinklicken.</p>";
	$("html, body").clearQueue().dequeue().stop();
	clearInterval(timer);
	messageoverlay(disable, "1.5");
	$('body').css('cursor', 'normal');
}

$(document).ready(function() {
	$('body').click(function() {
		running = !running;
		if(running) {
			startAnimation();
		} else {
			stopAnimation();
		}
	});
	setTimeout( function() {
		messageoverlay("<p><b>Diese Seite ist zur Anzeige am Beamer gedacht.</b></p><p>Klicke irgendwo auf die Seite, um Autoscroll und Autoreload zu aktivieren.</p>", "1.3");
	}, 200);
//	startAnimation();
	$('html').keypress(function(e) {
		if( e.which == 43 ) {
			// +
			if( animationduration < 200 ) {
				animationduration += 5;
				if( running ) {
					stopAnimation();
					startAnimation();
				}
			}
		} else if( e.which == 45 ) {
			// -
			if( animationduration > 20 ) {
				animationduration -= 5;
				if( running ) {
					stopAnimation();
					startAnimation();
				}
			}
		}
	});
});
// ]]>
</script>
</div>
